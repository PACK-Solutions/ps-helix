<nav 
  class="menu"
  [class.vertical]="mode === 'vertical'"
  [class.horizontal]="mode === 'horizontal'"
  [class.compact]="variant === 'compact'"
  [class.expanded]="variant === 'expanded'"
  [class.collapsed]="collapsed"
  role="navigation"
>
  @if (collapsible) {
    <button 
      class="menu-collapse-button"
      (click)="toggleCollapse()"
      [attr.aria-expanded]="!collapsed"
      [attr.aria-label]="collapsed ? 'Expand menu' : 'Collapse menu'"
    >
      <i class="ph ph-{{ collapsed ? 'caret-right' : 'caret-left' }}" aria-hidden="true"></i>
    </button>
  }

  <ul class="menu-list" role="menubar">
    @for (item of items; track item.id) {
      @if (item.divider) {
        <li class="menu-divider" role="separator"></li>
      } @else {
        <li 
          class="menu-item"
          [class.has-children]="item.children?.length"
          [class.expanded]="isExpanded(item)"
          [class.disabled]="item.disabled"
          role="none"
        >
          <a
            class="menu-link"
            [routerLink]="item.path"
            [class.active]="item.path && false"
            role="menuitem"
            [attr.aria-disabled]="item.disabled"
            [attr.aria-expanded]="item.children?.length ? isExpanded(item) : null"
            (click)="toggleItem(item)"
          >
            @if (item.icon) {
              <i class="ph ph-{{ item.icon }}" aria-hidden="true"></i>
            }
            
            @if (!collapsed || mode === 'horizontal') {
              <span class="menu-label">{{ item.label | translate }}</span>
            }

            @if (item.badge) {
              <span class="menu-badge">{{ item.badge }}</span>
            }

            @if (item.children?.length) {
              <i 
                class="ph ph-caret-down menu-arrow"
                [class.expanded]="isExpanded(item)"
                aria-hidden="true"
              ></i>
            }
          </a>

          @if (item.children?.length && isExpanded(item)) {
            <ul class="submenu" role="menu">
              @for (child of item.children; track child.id) {
                <li class="menu-item" role="none">
                  <a
                    class="menu-link"
                    [routerLink]="child.path"
                    [class.active]="child.path && false"
                    role="menuitem"
                    [attr.aria-disabled]="child.disabled"
                    (click)="toggleItem(child)"
                  >
                    @if (child.icon) {
                      <i class="ph ph-{{ child.icon }}" aria-hidden="true"></i>
                    }
                    <span class="menu-label">{{ child.label | translate }}</span>
                    @if (child.badge) {
                      <span class="menu-badge">{{ child.badge }}</span>
                    }
                  </a>
                </li>
              }
            </ul>
          }
        </li>
      }
    }
  </ul>
</nav>