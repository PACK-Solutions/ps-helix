<div 
  class="stepper-container"
  [class.vertical]="orientation === 'vertical'"
  [class.numbered]="variant === 'numbered'"
  [class.progress]="variant === 'progress'"
  [class.icon-top]="variant === 'icon-top'"
>
  <!-- Steps Header -->
  <div class="stepper-header" role="tablist">
    @for (step of steps; track step; let i = $index) {
      <div 
        class="step-header"
        [class.active]="i === activeStep"
        [class.completed]="step.completed"
        [class.disabled]="!canActivateStep(i) || step.disabled"
        [class.error]="!!step.error"
        [class.warning]="!!step.warning"
        [class.success]="!!step.success"
      >
        <!-- Step Indicator -->
        <div 
          class="step-indicator"
          role="tab"
          [attr.aria-selected]="i === activeStep"
          [attr.aria-disabled]="!canActivateStep(i) || step.disabled"
          (click)="canActivateStep(i) && !step.disabled && goToStep(i)"
          [attr.aria-describedby]="step.error ? 'error-' + i : step.warning ? 'warning-' + i : null"
        >
          @if (variant === 'numbered') {
            <span class="step-number">{{ i + 1 }}</span>
          } @else if (step.completed) {
            <i class="ph ph-check" aria-hidden="true"></i>
          } @else if (step.icon) {
            <i class="ph ph-{{ step.icon }}" aria-hidden="true"></i>
          } @else {
            <span class="step-dot"></span>
          }
        </div>

        <!-- Step Label -->
        <div class="step-label">
          <span class="step-title">{{ step.title | translate }}</span>
          @if (step.subtitle) {
            <span class="step-subtitle">{{ step.subtitle | translate }}</span>
          }
          @if (step.error) {
            <span class="step-error" [id]="'error-' + i">{{ step.error | translate }}</span>
          }
          @if (step.warning) {
            <span class="step-warning" [id]="'warning-' + i">{{ step.warning | translate }}</span>
          }
          @if (step.success) {
            <span class="step-success" [id]="'success-' + i">{{ step.success | translate }}</span>
          }
        </div>

        <!-- Connector -->
        @if (i < steps.length - 1) {
          <div class="step-connector">
            <span class="connector-line"></span>
          </div>
        }
      </div>
    }
  </div>

  <!-- Steps Content -->
  <div class="stepper-content">
    @for (step of steps; track step; let i = $index) {
      <div 
        class="step-content"
        role="tabpanel"
        [class.active]="i === activeStep"
        [attr.aria-labelledby]="'step-' + i"
        [attr.hidden]="i !== activeStep"
      >
        <ng-container *ngTemplateOutlet="step.content"></ng-container>
      </div>
    }
  </div>
</div>