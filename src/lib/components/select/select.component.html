<div 
  class="select-container"
  [class.open]="state.isOpen()"
  [class.disabled]="disabled"
  [class.error]="error"
  [class.success]="success"
  [class.small]="size === 'small'"
  [class.large]="size === 'large'"
>
  <div 
    class="select-trigger"
    role="combobox"
    [attr.aria-expanded]="state.isOpen()"
    [attr.aria-disabled]="disabled"
    [attr.aria-required]="required"
    [attr.aria-invalid]="!!error"
    (click)="toggle()"
  >
    <div class="select-value">
      @if (loading) {
        <div class="select-loader"></div>
      }
      <span [class.placeholder]="!value">{{ state.selectedLabel() }}</span>
    </div>

    <div class="select-actions">
      @if (clearable && value) {
        <button
          type="button"
          class="select-clear"
          (click)="clear($event)"
          [attr.aria-label]="'SELECT.CLEAR' | translate"
        >
          <i class="ph ph-x" aria-hidden="true"></i>
        </button>
      }
      <i 
        class="ph ph-caret-down select-arrow"
        [class.open]="state.isOpen()"
        aria-hidden="true"
      ></i>
    </div>
  </div>

  @if (state.isOpen()) {
    <div 
      class="select-dropdown"
      role="listbox"
      [attr.aria-multiselectable]="multiple"
    >
      @if (searchable) {
        <div class="select-search">
          <i class="ph ph-magnifying-glass" aria-hidden="true"></i>
          <input
            type="text"
            [placeholder]="'SELECT.PLACEHOLDER.SEARCH' | translate"
            [value]="state.searchTerm()"
            (input)="onSearch($event)"
            (click)="$event.stopPropagation()"
          />
        </div>
      }

      <div class="select-options">
        @if (state.filteredOptions().length === 0) {
          <div class="select-no-results">
            {{ 'SELECT.NO_RESULTS' | translate }}
          </div>
        }

        @for (option of state.filteredOptions(); track option.value) {
          <div
            class="select-option"
            role="option"
            [class.selected]="isSelected(option)"
            [class.disabled]="option.disabled"
            [attr.aria-selected]="isSelected(option)"
            [attr.aria-disabled]="option.disabled"
            (click)="select(option)"
          >
            @if (multiple) {
              <div class="select-checkbox">
                <i class="ph ph-check" aria-hidden="true"></i>
              </div>
            }
            {{ option.label | translate }}
          </div>
        }
      </div>
    </div>
  }

  @if (error) {
    <div class="select-error" role="alert">
      {{ error | translate }}
    </div>
  }

  @if (success) {
    <div class="select-success" role="status">
      {{ success | translate }}
    </div>
  }
</div>